{% load staticfiles %}
{% load markdown %}
{% url 'onechan:show_post' post_id=post.id as post_url %}
<article class="post" id="post_{{post.id}}">
	<header>
		<h2>
		{% if post.category %}
			<a href="{% url 'onechan:category_posts' category_id=post.category.id %}" class="post-category">{{ post.category.name }}</a>
		&rarr;
		{% endif %}
		<a href="{{ post.link| default:post_url }}"{% if post.link %}class="post-link-external" target="_blank"{% endif %}>
			{{ post.title }}
		</a>
	</header>
	<div class="post-body">
		{{ post.text| markdown }}
		{% if full_text %}
			{{ post.text_full| markdown }}
		{% elif post.text_full %}
			<p><a class="post-link-more" href="{{ post_url }}">Читать дальше</a></p>
		{% endif %}
        {% if post.hidden %}
        	<small class="post-hide-reason">{{ post.hide_reason }}</small>
        {% endif %}
	</div>
	<footer class="post-attrs">
		<span class="favourite-icon favourite-icon-{% if post in favourites %}active{% else %}disabled{% endif %}"
				data-favourite-url="{% url 'onechan:set_favourite' post_id=post.id %}"
				data-favourite-current-value="{% if post in favourites %}1{% else %}0{% endif %}"
				id="post_{{ post.id }}_favorite">
			<span class="fa fa-star"></span>
		</span>
		{% if post.rateable %}
			<span class="post-rate-buttons" data-rate-url="{% url 'onechan:rate_post' post_id=post.id %}" >
				<span class="fa fa-plus-square-o" data-rate-value="1"></span>
				<strong id="post_rating_{{ post.id }}" class="post-rating post-rating-{% if post.rating >= 0 %}positive{% else %}negative{% endif %}">{{ post.rating }}</strong>
				<span class="fa fa-minus-square-o" data-rate-value="-1"></span>
			</span>
		{% endif %}
		<span class="post-pubdate">
			<time datetime="{{post.pub_date.isoformat}}">{{ post.pub_date | date:'d M Y @ H:i' }}</time>
		</span>
		<span class="post-id">
			<a href="{{ post_url }}">№{{post.id}}</a>
		</span>
		<span class="post-author-board">
		{% if post.author_board %}
			<img src="{{ post.author_board.img.url }}"/>
		{% else %}
			<span class="fa fa-lg fa-user-secret"></span>
		{% endif %}
		</span>
		<span class="post-comment-count">
			<a href="{{ post_url }}">
				{% if post.closed %}Обсуждение закрыто{% else %}Обсудить{% endif %} ({{ post.comment_set.count| default:0 }})
			</a>
		</span>
	<footer>
</article>
